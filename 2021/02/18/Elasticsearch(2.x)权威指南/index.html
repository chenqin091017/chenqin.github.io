<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>
    Elasticsearch权威指南(2.x) |
    
    CUBE</title>
  
  <link rel="shortcut icon" href="/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<script src="/js/pace.min.js"></script>

<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <main class="content">
    <section class="outer">
  <article id="post-Elasticsearch(2.x)权威指南" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      

<h1 class="article-title" itemprop="name">
  Elasticsearch权威指南(2.x)
</h1>



    </header>
    

    
    <div class="article-meta">
      <a href="/2021/02/18/Elasticsearch(2.x)%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97/" class="article-date">
  <time datetime="2021-02-17T16:00:00.000Z" itemprop="datePublished">2021-02-18</time>
</a>
      
<div class="article-category">
  <a class="article-category-link" href="/categories/Elasticsearch/">Elasticsearch</a>
</div>

    </div>
    

    
    
<div class="tocbot"></div>

    

    <div class="article-entry" itemprop="articleBody">
      
      
<div class="article-gallery">
  <div class="article-gallery-photos">
    
    
    <img src="https://bcc-es-prod.oss-cn-hangzhou.aliyuncs.com/im/20200520/091017/u=463240096,4017976753&fm=26&gp=0.jpg" itemprop="image">
    
    
  </div>
</div>

      
      <blockquote>
<p>注意文档中使用的Elasticsearch版本为2.x版本，此次阅读仅是为了较系统的对Elasticsearch进行学习。</p>
<p>后续再计划对最新版本的文档进行研读；</p>
<p>本地环境使用的Elasticseach版本为6.8，所在在阅读过程中会对兼容性问题进行解决；</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/cluster-health.html">Elasticsearch权威指南</a></p>
<span id="more"></span>

<h2 id="1、索引员工文档"><a href="#1、索引员工文档" class="headerlink" title="1、索引员工文档"></a>1、索引员工文档</h2><blockquote>
<p>其中<code>megacorp</code>为索引，<code>employee</code>为类型</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT <span class="string">&quot;localhost:9200/megacorp/employee/1?pretty&quot;</span> -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;first_name&quot;</span> : <span class="string">&quot;John&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;last_name&quot;</span> :  <span class="string">&quot;Smith&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;age&quot;</span> :        <span class="number">25</span>,</span><br><span class="line">    <span class="attr">&quot;about&quot;</span> :      <span class="string">&quot;I love to go rock climbing&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;interests&quot;</span>: [ <span class="string">&quot;sports&quot;</span>, <span class="string">&quot;music&quot;</span> ]</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT <span class="string">&quot;localhost:9200/megacorp/employee/2?pretty&quot;</span> -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;first_name&quot;</span> :  <span class="string">&quot;Jane&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;last_name&quot;</span> :   <span class="string">&quot;Smith&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;age&quot;</span> :         <span class="number">32</span>,</span><br><span class="line">    <span class="attr">&quot;about&quot;</span> :       <span class="string">&quot;I like to collect rock albums&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;interests&quot;</span>:  [ <span class="string">&quot;music&quot;</span> ]</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT <span class="string">&quot;localhost:9200/megacorp/employee/3?pretty&quot;</span> -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;first_name&quot;</span> :  <span class="string">&quot;Douglas&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;last_name&quot;</span> :   <span class="string">&quot;Fir&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;age&quot;</span> :         <span class="number">35</span>,</span><br><span class="line">    <span class="attr">&quot;about&quot;</span>:        <span class="string">&quot;I like to build cabinets&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;interests&quot;</span>:  [ <span class="string">&quot;forestry&quot;</span> ]</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="2、检索文档"><a href="#2、检索文档" class="headerlink" title="2、检索文档"></a>2、检索文档</h2><ul>
<li><p>cURL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET <span class="string">&quot;localhost:9200/megacorp/employee/1?pretty&quot;</span></span><br></pre></td></tr></table></figure></li>
<li><p>Response</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="attr">&quot;_version&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;_seq_no&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;_primary_term&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;found&quot;</span>:<span class="literal">true</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;John&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Smith&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">25</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I love to go rock climbing&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;sports&quot;</span>,<span class="string">&quot;music&quot;</span>]&#125;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="3、轻量搜索"><a href="#3、轻量搜索" class="headerlink" title="3、轻量搜索"></a>3、轻量搜索</h2><h3 id="3-1、搜索所有数据"><a href="#3-1、搜索所有数据" class="headerlink" title="3.1、搜索所有数据"></a>3.1、搜索所有数据</h3><ul>
<li><p>cURL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET <span class="string">&quot;localhost:9200/megacorp/employee/_search?pretty&quot;</span></span><br></pre></td></tr></table></figure></li>
<li><p>Response</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;took&quot;</span>:<span class="number">3</span>,<span class="attr">&quot;timed_out&quot;</span>:<span class="literal">false</span>,<span class="attr">&quot;_shards&quot;</span>:&#123;<span class="attr">&quot;total&quot;</span>:<span class="number">5</span>,<span class="attr">&quot;successful&quot;</span>:<span class="number">5</span>,<span class="attr">&quot;skipped&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;failed&quot;</span>:<span class="number">0</span>&#125;,<span class="attr">&quot;hits&quot;</span>:&#123;<span class="attr">&quot;total&quot;</span>:<span class="number">3</span>,<span class="attr">&quot;max_score&quot;</span>:<span class="number">1.0</span>,<span class="attr">&quot;hits&quot;</span>:[&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;2&quot;</span>,<span class="attr">&quot;_score&quot;</span>:<span class="number">1.0</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;Jane&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Smith&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">32</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I like to collect rock albums&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;music&quot;</span>]&#125;&#125;,&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="attr">&quot;_score&quot;</span>:<span class="number">1.0</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;John&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Smith&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">25</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I love to go rock climbing&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;sports&quot;</span>,<span class="string">&quot;music&quot;</span>]&#125;&#125;,&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;3&quot;</span>,<span class="attr">&quot;_score&quot;</span>:<span class="number">1.0</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;Douglas&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Fir&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">35</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I like to build cabinets&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;forestry&quot;</span>]&#125;&#125;]&#125;&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-2、使用q参数赋值的方式进行搜索"><a href="#3-2、使用q参数赋值的方式进行搜索" class="headerlink" title="3.2、使用q参数赋值的方式进行搜索"></a>3.2、使用<code>q</code>参数赋值的方式进行搜索</h3></li>
<li><p>cURL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET <span class="string">&quot;localhost:9200/megacorp/employee/_search?q=last_name:Smith+first_name:John&amp;pretty&quot;</span></span><br></pre></td></tr></table></figure></li>
<li><p>Response</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;took&quot;</span> : <span class="number">7</span>,</span><br><span class="line">  <span class="attr">&quot;timed_out&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;_shards&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;total&quot;</span> : <span class="number">21</span>,</span><br><span class="line">    <span class="attr">&quot;successful&quot;</span> : <span class="number">21</span>,</span><br><span class="line">    <span class="attr">&quot;skipped&quot;</span> : <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;failed&quot;</span> : <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;hits&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;total&quot;</span> : <span class="number">2</span>,</span><br><span class="line">    <span class="attr">&quot;max_score&quot;</span> : <span class="number">0.5753642</span>,</span><br><span class="line">    <span class="attr">&quot;hits&quot;</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;_index&quot;</span> : <span class="string">&quot;megacorp&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_type&quot;</span> : <span class="string">&quot;employee&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_id&quot;</span> : <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_score&quot;</span> : <span class="number">0.5753642</span>,</span><br><span class="line">        <span class="attr">&quot;_source&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;first_name&quot;</span> : <span class="string">&quot;John&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;last_name&quot;</span> : <span class="string">&quot;Smith&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;age&quot;</span> : <span class="number">25</span>,</span><br><span class="line">          <span class="attr">&quot;about&quot;</span> : <span class="string">&quot;I love to go rock climbing&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;interests&quot;</span> : [</span><br><span class="line">            <span class="string">&quot;sports&quot;</span>,</span><br><span class="line">            <span class="string">&quot;music&quot;</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;_index&quot;</span> : <span class="string">&quot;megacorp&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_type&quot;</span> : <span class="string">&quot;employee&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_id&quot;</span> : <span class="string">&quot;2&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_score&quot;</span> : <span class="number">0.2876821</span>,</span><br><span class="line">        <span class="attr">&quot;_source&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;first_name&quot;</span> : <span class="string">&quot;Jane&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;last_name&quot;</span> : <span class="string">&quot;Smith&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;age&quot;</span> : <span class="number">32</span>,</span><br><span class="line">          <span class="attr">&quot;about&quot;</span> : <span class="string">&quot;I like to collect rock albums&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;interests&quot;</span> : [</span><br><span class="line">            <span class="string">&quot;music&quot;</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="4、使用查询"><a href="#4、使用查询" class="headerlink" title="4、使用查询"></a>4、使用查询</h2><ul>
<li><p>cURL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET <span class="string">&quot;localhost:9200/megacorp/employee/_search?pretty&quot;</span> -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;query&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;match&quot;</span> : &#123;</span><br><span class="line">            <span class="attr">&quot;last_name&quot;</span> : <span class="string">&quot;Smith&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure></li>
<li><p>Response</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;took&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;timed_out&quot;</span>:<span class="literal">false</span>,<span class="attr">&quot;_shards&quot;</span>:&#123;<span class="attr">&quot;total&quot;</span>:<span class="number">5</span>,<span class="attr">&quot;successful&quot;</span>:<span class="number">5</span>,<span class="attr">&quot;skipped&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;failed&quot;</span>:<span class="number">0</span>&#125;,<span class="attr">&quot;hits&quot;</span>:&#123;<span class="attr">&quot;total&quot;</span>:<span class="number">2</span>,<span class="attr">&quot;max_score&quot;</span>:<span class="number">0.2876821</span>,<span class="attr">&quot;hits&quot;</span>:[&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;2&quot;</span>,<span class="attr">&quot;_score&quot;</span>:<span class="number">0.2876821</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;Jane&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Smith&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">32</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I like to collect rock albums&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;music&quot;</span>]&#125;&#125;,&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="attr">&quot;_score&quot;</span>:<span class="number">0.2876821</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;John&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Smith&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">25</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I love to go rock climbing&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;sports&quot;</span>,<span class="string">&quot;music&quot;</span>]&#125;&#125;]&#125;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="5、使用过滤器"><a href="#5、使用过滤器" class="headerlink" title="5、使用过滤器"></a>5、使用过滤器</h2><ul>
<li><p>cURL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET <span class="string">&quot;localhost:9200/megacorp/employee/_search?pretty&quot;</span> -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;query&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;bool&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;must&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;match&quot;</span> : &#123;</span><br><span class="line">                    <span class="attr">&quot;last_name&quot;</span> : <span class="string">&quot;smith&quot;</span> </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;filter&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;range&quot;</span> : &#123;</span><br><span class="line">                    <span class="attr">&quot;age&quot;</span> : &#123; <span class="attr">&quot;gt&quot;</span> : <span class="number">30</span> &#125; </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>gt</code>:&gt;;<code>lt</code>:&lt;;<code>gte</code>:&gt;=;<code>lte</code>:&lt;=;</p>
</blockquote>
</li>
<li><p>Response</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;took&quot;</span>:<span class="number">6</span>,<span class="attr">&quot;timed_out&quot;</span>:<span class="literal">false</span>,<span class="attr">&quot;_shards&quot;</span>:&#123;<span class="attr">&quot;total&quot;</span>:<span class="number">5</span>,<span class="attr">&quot;successful&quot;</span>:<span class="number">5</span>,<span class="attr">&quot;skipped&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;failed&quot;</span>:<span class="number">0</span>&#125;,<span class="attr">&quot;hits&quot;</span>:&#123;<span class="attr">&quot;total&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;max_score&quot;</span>:<span class="number">0.2876821</span>,<span class="attr">&quot;hits&quot;</span>:[&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;2&quot;</span>,<span class="attr">&quot;_score&quot;</span>:<span class="number">0.2876821</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;Jane&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Smith&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">32</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I like to collect rock albums&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;music&quot;</span>]&#125;&#125;]&#125;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="6、全文索引（模糊）"><a href="#6、全文索引（模糊）" class="headerlink" title="6、全文索引（模糊）"></a>6、全文索引（模糊）</h2><blockquote>
<p>搜索所有喜欢rock climbing的员工，而搜索结果有Jane Smith，他是喜欢rock albums，只是提到了rock也被检索出来了，但是搜索结果中的<code>_score</code>得分较低；</p>
</blockquote>
<ul>
<li><p>cURL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET <span class="string">&quot;localhost:9200/megacorp/employee/_search?pretty&quot;</span> -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;query&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;match&quot;</span> : &#123;</span><br><span class="line">            <span class="attr">&quot;about&quot;</span> : <span class="string">&quot;rock climbing&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure></li>
<li><p>Response</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;took&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;timed_out&quot;</span>:<span class="literal">false</span>,<span class="attr">&quot;_shards&quot;</span>:&#123;<span class="attr">&quot;total&quot;</span>:<span class="number">5</span>,<span class="attr">&quot;successful&quot;</span>:<span class="number">5</span>,<span class="attr">&quot;skipped&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;failed&quot;</span>:<span class="number">0</span>&#125;,<span class="attr">&quot;hits&quot;</span>:&#123;<span class="attr">&quot;total&quot;</span>:<span class="number">2</span>,<span class="attr">&quot;max_score&quot;</span>:<span class="number">0.5753642</span>,<span class="attr">&quot;hits&quot;</span>:[&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="attr">&quot;_score&quot;</span>:<span class="number">0.5753642</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;John&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Smith&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">25</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I love to go rock climbing&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;sports&quot;</span>,<span class="string">&quot;music&quot;</span>]&#125;&#125;,&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;2&quot;</span>,<span class="attr">&quot;_score&quot;</span>:<span class="number">0.2876821</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;Jane&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Smith&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">32</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I like to collect rock albums&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;music&quot;</span>]&#125;&#125;]&#125;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="7、短语搜索（精确匹配一系列的单词或者短语）"><a href="#7、短语搜索（精确匹配一系列的单词或者短语）" class="headerlink" title="7、短语搜索（精确匹配一系列的单词或者短语）"></a>7、短语搜索（精确匹配一系列的单词或者短语）</h2><ul>
<li><p>cURL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET <span class="string">&quot;localhost:9200/megacorp/employee/_search?pretty&quot;</span> -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;query&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;match_phrase&quot;</span> : &#123;</span><br><span class="line">            <span class="attr">&quot;about&quot;</span> : <span class="string">&quot;rock climbing&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure></li>
<li><p>Response</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;took&quot;</span>:<span class="number">14</span>,<span class="attr">&quot;timed_out&quot;</span>:<span class="literal">false</span>,<span class="attr">&quot;_shards&quot;</span>:&#123;<span class="attr">&quot;total&quot;</span>:<span class="number">5</span>,<span class="attr">&quot;successful&quot;</span>:<span class="number">5</span>,<span class="attr">&quot;skipped&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;failed&quot;</span>:<span class="number">0</span>&#125;,<span class="attr">&quot;hits&quot;</span>:&#123;<span class="attr">&quot;total&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;max_score&quot;</span>:<span class="number">0.5753642</span>,<span class="attr">&quot;hits&quot;</span>:[&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="attr">&quot;_score&quot;</span>:<span class="number">0.5753642</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;John&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Smith&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">25</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I love to go rock climbing&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;sports&quot;</span>,<span class="string">&quot;music&quot;</span>]&#125;&#125;]&#125;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="8、高亮搜索"><a href="#8、高亮搜索" class="headerlink" title="8、高亮搜索"></a>8、高亮搜索</h2><blockquote>
<p>每个搜索结果中高亮部分文本片段，以便让用户知道为何该文档符合查询条件</p>
</blockquote>
<ul>
<li><p>cURL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET <span class="string">&quot;localhost:9200/megacorp/employee/_search?pretty&quot;</span> -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;query&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;match&quot;</span> : &#123;</span><br><span class="line">            <span class="attr">&quot;about&quot;</span> : <span class="string">&quot;rock climbing&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;highlight&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;fields&quot;</span> : &#123;</span><br><span class="line">            <span class="attr">&quot;about&quot;</span> : &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure></li>
<li><p>Response</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;took&quot;</span>:<span class="number">5</span>,<span class="attr">&quot;timed_out&quot;</span>:<span class="literal">false</span>,<span class="attr">&quot;_shards&quot;</span>:&#123;<span class="attr">&quot;total&quot;</span>:<span class="number">5</span>,<span class="attr">&quot;successful&quot;</span>:<span class="number">5</span>,<span class="attr">&quot;skipped&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;failed&quot;</span>:<span class="number">0</span>&#125;,<span class="attr">&quot;hits&quot;</span>:&#123;<span class="attr">&quot;total&quot;</span>:<span class="number">2</span>,<span class="attr">&quot;max_score&quot;</span>:<span class="number">0.5753642</span>,<span class="attr">&quot;hits&quot;</span>:[&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="attr">&quot;_score&quot;</span>:<span class="number">0.5753642</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;John&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Smith&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">25</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I love to go rock climbing&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;sports&quot;</span>,<span class="string">&quot;music&quot;</span>]&#125;,<span class="attr">&quot;highlight&quot;</span>:&#123;<span class="attr">&quot;about&quot;</span>:[<span class="string">&quot;I love to go &lt;em&gt;rock&lt;/em&gt; &lt;em&gt;climbing&lt;/em&gt;&quot;</span>]&#125;&#125;,&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;2&quot;</span>,<span class="attr">&quot;_score&quot;</span>:<span class="number">0.2876821</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;Jane&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Smith&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">32</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I like to collect rock albums&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;music&quot;</span>]&#125;,<span class="attr">&quot;highlight&quot;</span>:&#123;<span class="attr">&quot;about&quot;</span>:[<span class="string">&quot;I like to collect &lt;em&gt;rock&lt;/em&gt; albums&quot;</span>]&#125;&#125;]&#125;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="9、分析"><a href="#9、分析" class="headerlink" title="9、分析"></a>9、分析</h2><blockquote>
<p>聚合功能（aggregations）,允许我们急于数据生成一些精细的分析结果。</p>
</blockquote>
<h3 id="9-1、举个例子，挖掘员工中最受欢迎的兴趣爱好"><a href="#9-1、举个例子，挖掘员工中最受欢迎的兴趣爱好" class="headerlink" title="9.1、举个例子，挖掘员工中最受欢迎的兴趣爱好"></a>9.1、举个例子，挖掘员工中最受欢迎的兴趣爱好</h3><ul>
<li><p>cURL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET <span class="string">&quot;localhost:9200/megacorp/employee/_search?pretty&quot;</span> -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;all_interests&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;terms&quot;</span>: &#123; <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;interests&quot;</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure></li>
<li><p>异常情况处理</p>
<ul>
<li>上述curl请求之后，返回报错结果如下：</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;error&quot;</span>:&#123;<span class="attr">&quot;root_cause&quot;</span>:[&#123;<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;illegal_argument_exception&quot;</span>,<span class="attr">&quot;reason&quot;</span>:<span class="string">&quot;Fielddata is disabled on text fields by default. Set fielddata=true on [interests] in order to load fielddata in memory by uninverting the inverted index. Note that this can however use significant memory. Alternatively use a keyword field instead.&quot;</span>&#125;],<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;search_phase_execution_exception&quot;</span>,<span class="attr">&quot;reason&quot;</span>:<span class="string">&quot;all shards failed&quot;</span>,<span class="attr">&quot;phase&quot;</span>:<span class="string">&quot;query&quot;</span>,<span class="attr">&quot;grouped&quot;</span>:<span class="literal">true</span>,<span class="attr">&quot;failed_shards&quot;</span>:[&#123;<span class="attr">&quot;shard&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;node&quot;</span>:<span class="string">&quot;BN1eWLRDQneT3Zqr4leglw&quot;</span>,<span class="attr">&quot;reason&quot;</span>:&#123;<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;illegal_argument_exception&quot;</span>,<span class="attr">&quot;reason&quot;</span>:<span class="string">&quot;Fielddata is disabled on text fields by default. Set fielddata=true on [interests] in order to load fielddata in memory by uninverting the inverted index. Note that this can however use significant memory. Alternatively use a keyword field instead.&quot;</span>&#125;&#125;],<span class="attr">&quot;caused_by&quot;</span>:&#123;<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;illegal_argument_exception&quot;</span>,<span class="attr">&quot;reason&quot;</span>:<span class="string">&quot;Fielddata is disabled on text fields by default. Set fielddata=true on [interests] in order to load fielddata in memory by uninverting the inverted index. Note that this can however use significant memory. Alternatively use a keyword field instead.&quot;</span>,<span class="attr">&quot;caused_by&quot;</span>:&#123;<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;illegal_argument_exception&quot;</span>,<span class="attr">&quot;reason&quot;</span>:<span class="string">&quot;Fielddata is disabled on text fields by default. Set fielddata=true on [interests] in order to load fielddata in memory by uninverting the inverted index. Note that this can however use significant memory. Alternatively use a keyword field instead.&quot;</span>&#125;&#125;&#125;,<span class="attr">&quot;status&quot;</span>:<span class="number">400</span>&#125;</span><br></pre></td></tr></table></figure>

<p><code>Fielddata is disabled on text fields by default. Set fielddata=true on [interests] in order to load fielddata in memory by uninverting the inverted index. Note that this can however use significant memory. Alternatively use a keyword field instead.</code>翻译为<code>默认情况下，文本字段禁用Fielddata。设置fielddata=true对[兴趣]，以便通过反转反向索引在内存中加载fielddata。请注意，这可能会使用大量内存。或者使用关键字字段</code></p>
<ul>
<li><p>Elasticsearch 5.x版本以后，对排序和聚合等操作，用单独的数据结构(fielddata)缓存到内存里了，<strong>默认是不开启的</strong>，<strong>需要单独开启</strong>。<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/fielddata.html">参考elastic.co文档中fielddata</a></p>
</li>
<li><p>解决方法</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT <span class="string">&quot;localhost:9200/megacorp/_mapping/employee/&quot;</span> -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;interests&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;type&quot;</span>:<span class="string">&quot;text&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;fielddata&quot;</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>Response</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;took&quot;</span>:<span class="number">2</span>,<span class="attr">&quot;timed_out&quot;</span>:<span class="literal">false</span>,<span class="attr">&quot;_shards&quot;</span>:&#123;<span class="attr">&quot;total&quot;</span>:<span class="number">5</span>,<span class="attr">&quot;successful&quot;</span>:<span class="number">5</span>,<span class="attr">&quot;skipped&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;failed&quot;</span>:<span class="number">0</span>&#125;,<span class="attr">&quot;hits&quot;</span>:&#123;<span class="attr">&quot;total&quot;</span>:<span class="number">3</span>,<span class="attr">&quot;max_score&quot;</span>:<span class="number">1.0</span>,<span class="attr">&quot;hits&quot;</span>:[&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;2&quot;</span>,<span class="attr">&quot;_score&quot;</span>:<span class="number">1.0</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;Jane&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Smith&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">32</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I like to collect rock albums&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;music&quot;</span>]&#125;&#125;,&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="attr">&quot;_score&quot;</span>:<span class="number">1.0</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;John&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Smith&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">25</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I love to go rock climbing&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;sports&quot;</span>,<span class="string">&quot;music&quot;</span>]&#125;&#125;,&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;3&quot;</span>,<span class="attr">&quot;_score&quot;</span>:<span class="number">1.0</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;Douglas&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Fir&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">35</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I like to build cabinets&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;forestry&quot;</span>]&#125;&#125;]&#125;,<span class="attr">&quot;aggregations&quot;</span>:&#123;<span class="attr">&quot;all_interests&quot;</span>:&#123;<span class="attr">&quot;doc_count_error_upper_bound&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;sum_other_doc_count&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;buckets&quot;</span>:[&#123;<span class="attr">&quot;key&quot;</span>:<span class="string">&quot;music&quot;</span>,<span class="attr">&quot;doc_count&quot;</span>:<span class="number">2</span>&#125;,&#123;<span class="attr">&quot;key&quot;</span>:<span class="string">&quot;forestry&quot;</span>,<span class="attr">&quot;doc_count&quot;</span>:<span class="number">1</span>&#125;,&#123;<span class="attr">&quot;key&quot;</span>:<span class="string">&quot;sports&quot;</span>,<span class="attr">&quot;doc_count&quot;</span>:<span class="number">1</span>&#125;]&#125;&#125;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="9-2、举个例子，想知道叫Smith的员工中最受欢迎的兴趣爱好"><a href="#9-2、举个例子，想知道叫Smith的员工中最受欢迎的兴趣爱好" class="headerlink" title="9.2、举个例子，想知道叫Smith的员工中最受欢迎的兴趣爱好"></a>9.2、举个例子，想知道叫Smith的员工中最受欢迎的兴趣爱好</h3><ul>
<li><p>cURL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET <span class="string">&quot;localhost:9200/megacorp/employee/_search?pretty&quot;</span> -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;last_name&quot;</span>: <span class="string">&quot;smith&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;all_interests&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;terms&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;interests&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure></li>
<li><p>Response</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;took&quot;</span>:<span class="number">2</span>,<span class="attr">&quot;timed_out&quot;</span>:<span class="literal">false</span>,<span class="attr">&quot;_shards&quot;</span>:&#123;<span class="attr">&quot;total&quot;</span>:<span class="number">5</span>,<span class="attr">&quot;successful&quot;</span>:<span class="number">5</span>,<span class="attr">&quot;skipped&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;failed&quot;</span>:<span class="number">0</span>&#125;,<span class="attr">&quot;hits&quot;</span>:&#123;<span class="attr">&quot;total&quot;</span>:<span class="number">2</span>,<span class="attr">&quot;max_score&quot;</span>:<span class="number">0.2876821</span>,<span class="attr">&quot;hits&quot;</span>:[&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;2&quot;</span>,<span class="attr">&quot;_score&quot;</span>:<span class="number">0.2876821</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;Jane&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Smith&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">32</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I like to collect rock albums&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;music&quot;</span>]&#125;&#125;,&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="attr">&quot;_score&quot;</span>:<span class="number">0.2876821</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;John&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Smith&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">25</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I love to go rock climbing&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;sports&quot;</span>,<span class="string">&quot;music&quot;</span>]&#125;&#125;]&#125;,<span class="attr">&quot;aggregations&quot;</span>:&#123;<span class="attr">&quot;all_interests&quot;</span>:&#123;<span class="attr">&quot;doc_count_error_upper_bound&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;sum_other_doc_count&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;buckets&quot;</span>:[&#123;<span class="attr">&quot;key&quot;</span>:<span class="string">&quot;music&quot;</span>,<span class="attr">&quot;doc_count&quot;</span>:<span class="number">2</span>&#125;,&#123;<span class="attr">&quot;key&quot;</span>:<span class="string">&quot;sports&quot;</span>,<span class="attr">&quot;doc_count&quot;</span>:<span class="number">1</span>&#125;]&#125;&#125;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="9-3、聚合支持分级汇总，查询特定兴趣爱好员工的平均年龄"><a href="#9-3、聚合支持分级汇总，查询特定兴趣爱好员工的平均年龄" class="headerlink" title="9.3、聚合支持分级汇总，查询特定兴趣爱好员工的平均年龄"></a>9.3、聚合支持分级汇总，查询特定兴趣爱好员工的平均年龄</h3><ul>
<li><p>cURL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET <span class="string">&quot;localhost:9200/megacorp/employee/_search?pretty&quot;</span> -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;aggs&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;all_interests&quot;</span> : &#123;</span><br><span class="line">            <span class="attr">&quot;terms&quot;</span> : &#123; <span class="attr">&quot;field&quot;</span> : <span class="string">&quot;interests&quot;</span> &#125;,</span><br><span class="line">            <span class="attr">&quot;aggs&quot;</span> : &#123;</span><br><span class="line">                <span class="attr">&quot;avg_age&quot;</span> : &#123;</span><br><span class="line">                    <span class="attr">&quot;avg&quot;</span> : &#123; <span class="attr">&quot;field&quot;</span> : <span class="string">&quot;age&quot;</span> &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure></li>
<li><p>Response</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;took&quot;</span>:<span class="number">22</span>,<span class="attr">&quot;timed_out&quot;</span>:<span class="literal">false</span>,<span class="attr">&quot;_shards&quot;</span>:&#123;<span class="attr">&quot;total&quot;</span>:<span class="number">5</span>,<span class="attr">&quot;successful&quot;</span>:<span class="number">5</span>,<span class="attr">&quot;skipped&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;failed&quot;</span>:<span class="number">0</span>&#125;,<span class="attr">&quot;hits&quot;</span>:&#123;<span class="attr">&quot;total&quot;</span>:<span class="number">3</span>,<span class="attr">&quot;max_score&quot;</span>:<span class="number">1.0</span>,<span class="attr">&quot;hits&quot;</span>:[&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;2&quot;</span>,<span class="attr">&quot;_score&quot;</span>:<span class="number">1.0</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;Jane&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Smith&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">32</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I like to collect rock albums&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;music&quot;</span>]&#125;&#125;,&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="attr">&quot;_score&quot;</span>:<span class="number">1.0</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;John&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Smith&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">25</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I love to go rock climbing&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;sports&quot;</span>,<span class="string">&quot;music&quot;</span>]&#125;&#125;,&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;3&quot;</span>,<span class="attr">&quot;_score&quot;</span>:<span class="number">1.0</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;Douglas&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Fir&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">35</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I like to build cabinets&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;forestry&quot;</span>]&#125;&#125;]&#125;,<span class="attr">&quot;aggregations&quot;</span>:&#123;<span class="attr">&quot;all_interests&quot;</span>:&#123;<span class="attr">&quot;doc_count_error_upper_bound&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;sum_other_doc_count&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;buckets&quot;</span>:[&#123;<span class="attr">&quot;key&quot;</span>:<span class="string">&quot;music&quot;</span>,<span class="attr">&quot;doc_count&quot;</span>:<span class="number">2</span>,<span class="attr">&quot;avg_age&quot;</span>:&#123;<span class="attr">&quot;value&quot;</span>:<span class="number">28.5</span>&#125;&#125;,&#123;<span class="attr">&quot;key&quot;</span>:<span class="string">&quot;forestry&quot;</span>,<span class="attr">&quot;doc_count&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;avg_age&quot;</span>:&#123;<span class="attr">&quot;value&quot;</span>:<span class="number">35.0</span>&#125;&#125;,&#123;<span class="attr">&quot;key&quot;</span>:<span class="string">&quot;sports&quot;</span>,<span class="attr">&quot;doc_count&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;avg_age&quot;</span>:&#123;<span class="attr">&quot;value&quot;</span>:<span class="number">25.0</span>&#125;&#125;]&#125;&#125;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="10、查看Elasticsearch集群健康情况"><a href="#10、查看Elasticsearch集群健康情况" class="headerlink" title="10、查看Elasticsearch集群健康情况"></a>10、查看Elasticsearch集群健康情况</h2><ul>
<li><p>cURL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET <span class="string">&quot;localhost:9200/_cluster/health?pretty&quot;</span></span><br></pre></td></tr></table></figure></li>
<li><p>Response</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;cluster_name&quot;</span>: <span class="string">&quot;elasticsearch&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;yellow&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;timed_out&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;number_of_nodes&quot;</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">&quot;number_of_data_nodes&quot;</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">&quot;active_primary_shards&quot;</span>: <span class="number">27</span>,</span><br><span class="line">  <span class="attr">&quot;active_shards&quot;</span>: <span class="number">27</span>,</span><br><span class="line">  <span class="attr">&quot;relocating_shards&quot;</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;initializing_shards&quot;</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;unassigned_shards&quot;</span>: <span class="number">23</span>,</span><br><span class="line">  <span class="attr">&quot;delayed_unassigned_shards&quot;</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;number_of_pending_tasks&quot;</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;number_of_in_flight_fetch&quot;</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;task_max_waiting_in_queue_millis&quot;</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;active_shards_percent_as_number&quot;</span>: <span class="number">54.0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>green</code>:所有的主分片和副本都正常运行；<code>yellow</code>:所有的主分片都正常运行，但不是所有的副本分片都正常运行；<code>red</code>:有主分片没能正常运行；</p>
</blockquote>
</li>
</ul>
<h2 id="11、返回文档的部分"><a href="#11、返回文档的部分" class="headerlink" title="11、返回文档的部分"></a>11、返回文档的部分</h2><h3 id="11-1、指定返回age和interests两个部分的数据"><a href="#11-1、指定返回age和interests两个部分的数据" class="headerlink" title="11.1、指定返回age和interests两个部分的数据"></a>11.1、指定返回<code>age</code>和<code>interests</code>两个部分的数据</h3><ul>
<li><p>cURL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET <span class="string">&quot;localhost:9200/megacorp/employee/1?_source=age,interests&amp;pretty&quot;</span></span><br></pre></td></tr></table></figure></li>
<li><p>Response</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="attr">&quot;_version&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;_seq_no&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;_primary_term&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;found&quot;</span>:<span class="literal">true</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;sports&quot;</span>,<span class="string">&quot;music&quot;</span>],<span class="attr">&quot;age&quot;</span>:<span class="number">25</span>&#125;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="11-2、只返回文档部分"><a href="#11-2、只返回文档部分" class="headerlink" title="11.2、只返回文档部分"></a>11.2、只返回文档部分</h3><ul>
<li><p>cURL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET <span class="string">&quot;localhost:9200/megacorp/employee/1/_source&quot;</span></span><br></pre></td></tr></table></figure></li>
<li><p>Response</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;John&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Smith&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">25</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I love to go rock climbing&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;sports&quot;</span>,<span class="string">&quot;music&quot;</span>]&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="12、文档的部分更新"><a href="#12、文档的部分更新" class="headerlink" title="12、文档的部分更新"></a>12、文档的部分更新</h2><ul>
<li><p>cURL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST <span class="string">&quot;localhost:9200/megacorp/employee/1/_update&quot;</span> -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">&quot;doc&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;tags&quot;</span> : [ <span class="string">&quot;testing&quot;</span> ],</span><br><span class="line">      <span class="attr">&quot;views&quot;</span>: <span class="number">0</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure></li>
<li><p>Respone</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="attr">&quot;_version&quot;</span>:<span class="number">2</span>,<span class="attr">&quot;result&quot;</span>:<span class="string">&quot;updated&quot;</span>,<span class="attr">&quot;_shards&quot;</span>:&#123;<span class="attr">&quot;total&quot;</span>:<span class="number">2</span>,<span class="attr">&quot;successful&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;failed&quot;</span>:<span class="number">0</span>&#125;,<span class="attr">&quot;_seq_no&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;_primary_term&quot;</span>:<span class="number">1</span>&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="13、使用脚本部分更新文档"><a href="#13、使用脚本部分更新文档" class="headerlink" title="13、使用脚本部分更新文档"></a>13、使用脚本部分更新文档</h2><blockquote>
<p>数组增加元素<code>&#123;&quot;script&quot;:&#123;&quot;inline&quot;:&quot;ctx._source.tags.add(params.tag)&quot;,&quot;params&quot;:&#123;&quot;tag&quot;:&quot;search&quot;&#125;&#125;&#125;</code>或者减少元素<code>&#123;&quot;script&quot;:&#123;&quot;inline&quot;:&quot;ctx._source.tags.remove(ctx._source.tags.indexOf(params.tag))&quot;,&quot;params&quot;:&#123;&quot;tag&quot;:&quot;search&quot;&#125;&#125;&#125;</code></p>
<p>该文档中以下的方式已经不兼容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   &quot;script&quot; : &quot;ctx._source.tags+=new_tag&quot;,</span><br><span class="line">   &quot;params&quot; : &#123;</span><br><span class="line">      &quot;new_tag&quot; : &quot;search&quot;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li><p>cURL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST <span class="string">&quot;localhost:9200/megacorp/employee/1/_update&quot;</span> -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">&quot;script&quot;</span> : <span class="string">&quot;ctx._source.views+=1&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure></li>
<li><p>cURL(数组增加元素)</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST <span class="string">&quot;localhost:9200/megacorp/employee/1/_update&quot;</span> -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;<span class="attr">&quot;script&quot;</span>:&#123;<span class="attr">&quot;inline&quot;</span>:<span class="string">&quot;ctx._source.tags.add(params.tag)&quot;</span>,<span class="attr">&quot;params&quot;</span>:&#123;<span class="attr">&quot;tag&quot;</span>:<span class="string">&quot;search&quot;</span>&#125;&#125;&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="14、取回多个文档"><a href="#14、取回多个文档" class="headerlink" title="14、取回多个文档"></a>14、取回多个文档</h2><h3 id="14-1、可以将index和type放在body体传入，此时可以分别传入不同的index和type"><a href="#14-1、可以将index和type放在body体传入，此时可以分别传入不同的index和type" class="headerlink" title="14.1、可以将index和type放在body体传入，此时可以分别传入不同的index和type"></a>14.1、可以将index和type放在body体传入，此时可以分别传入不同的index和type</h3><ul>
<li><p>cURL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET <span class="string">&quot;localhost:9200/_mget?pretty&quot;</span> -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">&quot;docs&quot;</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="attr">&quot;_index&quot;</span> : <span class="string">&quot;megacorp&quot;</span>,</span><br><span class="line">         <span class="attr">&quot;_type&quot;</span> :  <span class="string">&quot;employee&quot;</span>,</span><br><span class="line">         <span class="attr">&quot;_id&quot;</span> :    <span class="number">1</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="attr">&quot;_index&quot;</span> : <span class="string">&quot;megacorp&quot;</span>,</span><br><span class="line">         <span class="attr">&quot;_type&quot;</span> :  <span class="string">&quot;employee&quot;</span>,</span><br><span class="line">         <span class="attr">&quot;_id&quot;</span> :    <span class="number">2</span></span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure></li>
<li><p>Response</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;docs&quot;</span>:[&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="attr">&quot;_version&quot;</span>:<span class="number">10</span>,<span class="attr">&quot;_seq_no&quot;</span>:<span class="number">9</span>,<span class="attr">&quot;_primary_term&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;found&quot;</span>:<span class="literal">true</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;John&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Smith&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">25</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I love to go rock climbing&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;sports&quot;</span>,<span class="string">&quot;music&quot;</span>],<span class="attr">&quot;views&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;tags&quot;</span>:[<span class="string">&quot;testing&quot;</span>,<span class="string">&quot;search&quot;</span>]&#125;&#125;,&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;2&quot;</span>,<span class="attr">&quot;_version&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;_seq_no&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;_primary_term&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;found&quot;</span>:<span class="literal">true</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;Jane&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Smith&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">32</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I like to collect rock albums&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;music&quot;</span>]&#125;&#125;]&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="14-2、在pathvalue中确定index和type"><a href="#14-2、在pathvalue中确定index和type" class="headerlink" title="14.2、在pathvalue中确定index和type"></a>14.2、在pathvalue中确定index和type</h3><ul>
<li><p>cURL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET <span class="string">&quot;localhost:9200/megacorp/employee/_mget?pretty&quot;</span> -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;ids&quot;</span>:[<span class="string">&quot;2&quot;</span>,<span class="string">&quot;1&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure></li>
<li><p>Response</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;docs&quot;</span>:[&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;2&quot;</span>,<span class="attr">&quot;_version&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;_seq_no&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;_primary_term&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;found&quot;</span>:<span class="literal">true</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;Jane&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Smith&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">32</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I like to collect rock albums&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;music&quot;</span>]&#125;&#125;,&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="attr">&quot;_version&quot;</span>:<span class="number">10</span>,<span class="attr">&quot;_seq_no&quot;</span>:<span class="number">9</span>,<span class="attr">&quot;_primary_term&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;found&quot;</span>:<span class="literal">true</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;John&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Smith&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">25</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I love to go rock climbing&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;sports&quot;</span>,<span class="string">&quot;music&quot;</span>],<span class="attr">&quot;views&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;tags&quot;</span>:[<span class="string">&quot;testing&quot;</span>,<span class="string">&quot;search&quot;</span>]&#125;&#125;]&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="15、分页搜索"><a href="#15、分页搜索" class="headerlink" title="15、分页搜索"></a>15、分页搜索</h2><ul>
<li><p>cURL</p>
<blockquote>
<p>每页展示5条结果，可以用下面的方式请求得到1到3页的结果</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET <span class="string">&quot;localhost:9200/_search?size=5&amp;pretty&quot;</span></span><br><span class="line">curl -X GET <span class="string">&quot;localhost:9200/_search?size=5&amp;from=5&amp;pretty&quot;</span></span><br><span class="line">curl -X GET <span class="string">&quot;localhost:9200/_search?size=5&amp;from=10&amp;pretty&quot;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="16、多索引和多类型"><a href="#16、多索引和多类型" class="headerlink" title="16、多索引和多类型"></a>16、多索引和多类型</h2><ul>
<li><p>cURL</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/_search</span><br><span class="line">在所有的索引中搜索所有的类型</span><br><span class="line"> /gb/_search</span><br><span class="line">在 gb 索引中搜索所有的类型</span><br><span class="line"> /gb,us/_search</span><br><span class="line">在 gb 和 us 索引中搜索所有的文档</span><br><span class="line"> /g*,u*/_search</span><br><span class="line">在任何以 g 或者 u 开头的索引中搜索所有的类型</span><br><span class="line"> /gb/user/_search</span><br><span class="line">在 gb 索引中搜索 user 类型</span><br><span class="line"> /gb,us/user,tweet/_search</span><br><span class="line">在 gb 和 us 索引中搜索 user 和 tweet 类型</span><br><span class="line"> /_all/user,tweet/_search</span><br><span class="line">在所有的索引中搜索 user 和 tweet 类型</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="17、查看映射"><a href="#17、查看映射" class="headerlink" title="17、查看映射"></a>17、查看映射</h2><ul>
<li><p>cURL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /megacorp/_mapping/employee</span><br></pre></td></tr></table></figure></li>
<li><p>Response</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;megacorp&quot;</span>:&#123;<span class="attr">&quot;mappings&quot;</span>:&#123;<span class="attr">&quot;employee&quot;</span>:&#123;<span class="attr">&quot;properties&quot;</span>:&#123;<span class="attr">&quot;about&quot;</span>:&#123;<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;text&quot;</span>,<span class="attr">&quot;fields&quot;</span>:&#123;<span class="attr">&quot;keyword&quot;</span>:&#123;<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;keyword&quot;</span>,<span class="attr">&quot;ignore_above&quot;</span>:<span class="number">256</span>&#125;&#125;&#125;,<span class="attr">&quot;age&quot;</span>:&#123;<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;long&quot;</span>&#125;,<span class="attr">&quot;first_name&quot;</span>:&#123;<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;text&quot;</span>,<span class="attr">&quot;fields&quot;</span>:&#123;<span class="attr">&quot;keyword&quot;</span>:&#123;<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;keyword&quot;</span>,<span class="attr">&quot;ignore_above&quot;</span>:<span class="number">256</span>&#125;&#125;&#125;,<span class="attr">&quot;interests&quot;</span>:&#123;<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;text&quot;</span>,<span class="attr">&quot;fields&quot;</span>:&#123;<span class="attr">&quot;keyword&quot;</span>:&#123;<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;keyword&quot;</span>,<span class="attr">&quot;ignore_above&quot;</span>:<span class="number">256</span>&#125;&#125;,<span class="attr">&quot;fielddata&quot;</span>:<span class="literal">true</span>&#125;,<span class="attr">&quot;last_name&quot;</span>:&#123;<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;text&quot;</span>,<span class="attr">&quot;fields&quot;</span>:&#123;<span class="attr">&quot;keyword&quot;</span>:&#123;<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;keyword&quot;</span>,<span class="attr">&quot;ignore_above&quot;</span>:<span class="number">256</span>&#125;&#125;&#125;,<span class="attr">&quot;tags&quot;</span>:&#123;<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;text&quot;</span>,<span class="attr">&quot;fields&quot;</span>:&#123;<span class="attr">&quot;keyword&quot;</span>:&#123;<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;keyword&quot;</span>,<span class="attr">&quot;ignore_above&quot;</span>:<span class="number">256</span>&#125;&#125;&#125;,<span class="attr">&quot;views&quot;</span>:&#123;<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;long&quot;</span>&#125;&#125;&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="18、创建map中使用到的index和analyzer"><a href="#18、创建map中使用到的index和analyzer" class="headerlink" title="18、创建map中使用到的index和analyzer"></a>18、创建map中使用到的<code>index</code>和<code>analyzer</code></h2><ul>
<li><p>cURL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT <span class="string">&quot;localhost:9200/gb&quot;</span> -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;tweet&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;properties&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;tweet&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> :    <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;analyzer&quot;</span>: <span class="string">&quot;english&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;date&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> :   <span class="string">&quot;date&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;index&quot;</span>: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;user_id&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> :   <span class="string">&quot;long&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>6.8版本已经取消type为string的类型，以及index仅可赋值true或者false（而不是analyzed, not_analyzed,no）</p>
</blockquote>
</li>
</ul>
<h2 id="19、内部对象的映射"><a href="#19、内部对象的映射" class="headerlink" title="19、内部对象的映射"></a>19、内部对象的映射</h2><ul>
<li><p>cURL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">POST &#123;&#123;host&#125;&#125;/tweet/_doc/_create</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;tweet&quot;</span>:<span class="string">&quot;Elasticsearch is very flexible&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;user&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;id&quot;</span>:<span class="string">&quot;@johnsmith&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;gender&quot;</span>:<span class="string">&quot;male&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;age&quot;</span>:<span class="number">26</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>:&#123;</span><br><span class="line">            <span class="attr">&quot;full&quot;</span>:<span class="string">&quot;John Smith&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;first&quot;</span>:<span class="string">&quot;John&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;last&quot;</span>:<span class="string">&quot;Smith&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>此时tweet._doc的映射关系如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;tweet&quot;</span>:&#123;<span class="attr">&quot;mappings&quot;</span>:&#123;<span class="attr">&quot;_doc&quot;</span>:&#123;<span class="attr">&quot;properties&quot;</span>:&#123;<span class="attr">&quot;tweet&quot;</span>:&#123;<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;text&quot;</span>,<span class="attr">&quot;fields&quot;</span>:&#123;<span class="attr">&quot;keyword&quot;</span>:&#123;<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;keyword&quot;</span>,<span class="attr">&quot;ignore_above&quot;</span>:<span class="number">256</span>&#125;&#125;&#125;,<span class="attr">&quot;user&quot;</span>:&#123;<span class="attr">&quot;properties&quot;</span>:&#123;<span class="attr">&quot;age&quot;</span>:&#123;<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;long&quot;</span>&#125;,<span class="attr">&quot;gender&quot;</span>:&#123;<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;text&quot;</span>,<span class="attr">&quot;fields&quot;</span>:&#123;<span class="attr">&quot;keyword&quot;</span>:&#123;<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;keyword&quot;</span>,<span class="attr">&quot;ignore_above&quot;</span>:<span class="number">256</span>&#125;&#125;&#125;,<span class="attr">&quot;id&quot;</span>:&#123;<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;text&quot;</span>,<span class="attr">&quot;fields&quot;</span>:&#123;<span class="attr">&quot;keyword&quot;</span>:&#123;<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;keyword&quot;</span>,<span class="attr">&quot;ignore_above&quot;</span>:<span class="number">256</span>&#125;&#125;&#125;,<span class="attr">&quot;name&quot;</span>:&#123;<span class="attr">&quot;properties&quot;</span>:&#123;<span class="attr">&quot;first&quot;</span>:&#123;<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;text&quot;</span>,<span class="attr">&quot;fields&quot;</span>:&#123;<span class="attr">&quot;keyword&quot;</span>:&#123;<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;keyword&quot;</span>,<span class="attr">&quot;ignore_above&quot;</span>:<span class="number">256</span>&#125;&#125;&#125;,<span class="attr">&quot;full&quot;</span>:&#123;<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;text&quot;</span>,<span class="attr">&quot;fields&quot;</span>:&#123;<span class="attr">&quot;keyword&quot;</span>:&#123;<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;keyword&quot;</span>,<span class="attr">&quot;ignore_above&quot;</span>:<span class="number">256</span>&#125;&#125;&#125;,<span class="attr">&quot;last&quot;</span>:&#123;<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;text&quot;</span>,<span class="attr">&quot;fields&quot;</span>:&#123;<span class="attr">&quot;keyword&quot;</span>:&#123;<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;keyword&quot;</span>,<span class="attr">&quot;ignore_above&quot;</span>:<span class="number">256</span>&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>内部对象进行索引，将文档转化为以下的格式，</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;tweet&quot;</span>:            [elasticsearch, flexible, very],</span><br><span class="line">    <span class="attr">&quot;user.id&quot;</span>:          [@johnsmith],</span><br><span class="line">    <span class="attr">&quot;user.gender&quot;</span>:      [male],</span><br><span class="line">    <span class="attr">&quot;user.age&quot;</span>:         [<span class="number">26</span>],</span><br><span class="line">    <span class="attr">&quot;user.name.full&quot;</span>:   [john, smith],</span><br><span class="line">    <span class="attr">&quot;user.name.first&quot;</span>:  [john],</span><br><span class="line">    <span class="attr">&quot;user.name.last&quot;</span>:   [smith]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<ul>
<li><p>内部对象数组</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;followers&quot;</span>: [</span><br><span class="line">        &#123; <span class="attr">&quot;age&quot;</span>: <span class="number">35</span>, <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Mary White&quot;</span>&#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;age&quot;</span>: <span class="number">26</span>, <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Alex Jones&quot;</span>&#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;age&quot;</span>: <span class="number">19</span>, <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Lisa Smith&quot;</span>&#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>进行扁平化处理</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;followers.age&quot;</span>:[<span class="number">19</span>, <span class="number">26</span>, <span class="number">35</span>],</span><br><span class="line">    <span class="attr">&quot;followers.name&quot;</span>:[<span class="string">&quot;alex&quot;</span>, <span class="string">&quot;jones&quot;</span>, <span class="string">&quot;lisa&quot;</span>, <span class="string">&quot;smith&quot;</span>, <span class="string">&quot;mary&quot;</span>, <span class="string">&quot;white&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>扁平化处理之后，便将”age”: 35 &lt;-&gt; “name”: “Mary White”的相关性丢失了，此时的数据结构仅可以搜索出是否有一个26岁的追随者？而如何搜索出是否有一个26岁，名字叫做<em>Alex Jones</em> 的追随者？</p>
<p>解决这个问题需要引入嵌套对象（Nested）。</p>
</li>
</ul>
<h2 id="20、查询表达式"><a href="#20、查询表达式" class="headerlink" title="20、查询表达式"></a>20、查询表达式</h2><h3 id="20-1、简单查询"><a href="#20-1、简单查询" class="headerlink" title="20.1、简单查询"></a>20.1、简单查询</h3><ul>
<li><p>cURL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET localhost:<span class="number">9200</span>/megacorp/employee/_search?q=john</span><br><span class="line"></span><br><span class="line">GET localhost:<span class="number">9200</span>/megacorp/employee/_search?q=last_name:Smith+first_name:John</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="20-2、空查询"><a href="#20-2、空查询" class="headerlink" title="20.2、空查询"></a>20.2、空查询</h3><ul>
<li><p>cURL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">GET localhost:<span class="number">9200</span>/megacorp/employee/_search</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;query&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;match_all&quot;</span>:&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET localhost:<span class="number">9200</span>/megacorp/employee/_search</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>空查询等同上面的match_all</p>
</blockquote>
</li>
</ul>
<h3 id="20-3-match查询"><a href="#20-3-match查询" class="headerlink" title="20.3 match查询"></a>20.3 <code>match</code>查询</h3><ul>
<li><p>cURL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET localhost:<span class="number">9200</span>/megacorp/employee/_search</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;query&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;match&quot;</span>:&#123;</span><br><span class="line">            <span class="attr">&quot;about&quot;</span>:<span class="string">&quot;rock&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="20-4、multi-match-查询"><a href="#20-4、multi-match-查询" class="headerlink" title="20.4、multi_match 查询"></a>20.4、<code>multi_match</code> 查询</h3><blockquote>
<p><code>multi_match</code> 查询可以在多个字段上执行相同的 <code>match</code> 查询</p>
</blockquote>
<ul>
<li><p>cURL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GET localhost:<span class="number">9200</span>/megacorp/employee/_search</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;query&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;multi_match&quot;</span>:&#123;</span><br><span class="line">            <span class="attr">&quot;query&quot;</span>:<span class="string">&quot;rock search&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;fields&quot;</span>:[</span><br><span class="line">                <span class="string">&quot;tags&quot;</span>,</span><br><span class="line">                <span class="string">&quot;about&quot;</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="20-5、range查询"><a href="#20-5、range查询" class="headerlink" title="20.5、range查询"></a>20.5、<code>range</code>查询</h3><blockquote>
<p><code>range</code> 查询找出那些落在指定区间内的数字或者时间;<code>gt</code>:&gt;;<code>gte</code>:&gt;=;<code>lt</code>:&lt;;<code>lte</code>:&lt;=;</p>
</blockquote>
<ul>
<li><p>cURL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GET localhost:<span class="number">9200</span>/megacorp/employee/_search</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;query&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;range&quot;</span>:&#123;</span><br><span class="line">            <span class="attr">&quot;age&quot;</span>:&#123;</span><br><span class="line">                <span class="attr">&quot;gte&quot;</span>:<span class="number">20</span>,</span><br><span class="line">                <span class="attr">&quot;lt&quot;</span>:<span class="number">30</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="20-5、term查询"><a href="#20-5、term查询" class="headerlink" title="20.5、term查询"></a>20.5、<code>term</code>查询</h3><blockquote>
<p><code>term</code> 查询被用于精确值匹配，这些精确值可能是数字、时间、布尔或者<code>index</code>设置为false的text（如果index设置为true的text无法做到精确值匹配）</p>
</blockquote>
<ul>
<li><p>cURL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET localhost:<span class="number">9200</span>/megacorp/employee/_search</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;query&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;term&quot;</span>:&#123;</span><br><span class="line">            <span class="attr">&quot;age&quot;</span>:<span class="number">25</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="20-6、terms查询"><a href="#20-6、terms查询" class="headerlink" title="20.6、terms查询"></a>20.6、<code>terms</code>查询</h3><blockquote>
<p><code>terms</code> 查询和 <code>term</code> 查询一样，但它允许你指定多值进行匹配。如果这个字段包含了指定值中的任何一个值，那么这个文档满足条件</p>
</blockquote>
<ul>
<li><p>cURL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET localhost:<span class="number">9200</span>/megacorp/employee/_search</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;query&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;terms&quot;</span>:&#123;</span><br><span class="line">            <span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;sport&quot;</span>,<span class="string">&quot;forestry&quot;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>和 <code>term</code> 查询一样，<code>terms</code> 查询对于输入的文本不分析。它查询那些精确匹配的值（包括在大小写、重音、空格等方面的差异）</strong></p>
<h3 id="20-7、exists查询和missing查询"><a href="#20-7、exists查询和missing查询" class="headerlink" title="20.7、exists查询和missing查询"></a>20.7、<code>exists</code>查询和<code>missing</code>查询</h3><blockquote>
<p><code>exists</code> 查询和 <code>missing</code> 查询被用于查找那些指定字段中有值 (<code>exists</code>) 或无值 (<code>missing</code>) 的文档。这与SQL中的 <code>IS_NULL</code> (<code>missing</code>) 和 <code>NOT IS_NULL</code> (<code>exists</code>) 在本质上具有共性</p>
</blockquote>
<ul>
<li><p><code>exists</code>cURL</p>
<blockquote>
<p><code>megacorp</code>.<code>employee</code>所有doc中<code>views</code> not is null的doc</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET localhost:<span class="number">9200</span>/megacorp/employee/_search</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;query&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;exists&quot;</span>:&#123;</span><br><span class="line">            <span class="attr">&quot;field&quot;</span>:<span class="string">&quot;views&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p><code>missing</code>cURL</p>
<blockquote>
<p>missing 已经从 ES 5 版本移除，使用<code>exists</code>查询取反的方式</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GET localhost:<span class="number">9200</span>/megacorp/employee/_search</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;bool&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;must_not&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;exists&quot;</span>: &#123;</span><br><span class="line">                    <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;views&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="30、组合多查询"><a href="#30、组合多查询" class="headerlink" title="30、组合多查询"></a>30、组合多查询</h2><h3 id="30-1、bool混合布尔查询"><a href="#30-1、bool混合布尔查询" class="headerlink" title="30.1、bool混合布尔查询"></a>30.1、<code>bool</code>混合布尔查询</h3><blockquote>
<p>现实的查询需求从来都没有那么简单；它们需要在多个字段上查询多种多样的文本，并且根据一系列的标准来过滤。为了构建类似的高级查询，你需要一种能够将多查询组合成单一查询的查询方法。</p>
<p>你可以用 <code>bool</code> 查询来实现你的需求。这种查询将多查询组合在一起，成为用户自己想要的布尔查询</p>
</blockquote>
<p>Occur的对照表（2.x）</p>
<table>
<thead>
<tr>
<th><strong>Occur</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>must</code></td>
<td>文档 <em>必须</em> 匹配这些条件才能被包含进来</td>
</tr>
<tr>
<td><code>must_not</code></td>
<td>文档 <em>必须不</em> 匹配这些条件才能被包含进来</td>
</tr>
<tr>
<td><code>should</code></td>
<td>如果满足这些语句中的任意语句，将增加 <code>_score</code> ，否则，无任何影响。它们主要用于修正每个文档的相关性得分</td>
</tr>
<tr>
<td><code>filter</code></td>
<td><em>必须</em> 匹配，但它以不评分、过滤模式来进行。这些语句对评分没有贡献，只是根据过滤标准来排除或包含文档</td>
</tr>
</tbody></table>
<p>Occur的对照表（6.8）</p>
<table>
<thead>
<tr>
<th><strong>Occur</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>must</code></td>
<td>The clause (query) must appear in matching documents and will contribute to the score.</td>
</tr>
<tr>
<td><code>must_not</code></td>
<td>The clause (query) must not appear in the matching documents. Clauses are executed in <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.8/query-filter-context.html">filter context</a> meaning that scoring is ignored and clauses are considered for caching. Because scoring is ignored, a score of <code>0</code> for all documents is returned.</td>
</tr>
<tr>
<td><code>should</code></td>
<td>The clause (query) should appear in the matching document. If the <code>bool</code> query is in a <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.8/query-filter-context.html">query context</a> and has a <code>must</code> or <code>filter</code> clause then a document will match the <code>bool</code> query even if none of the <code>should</code> queries match. In this case these clauses are only used to influence the score. If the <code>bool</code> query is in a <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.8/query-filter-context.html">filter context</a> or has neither <code>must</code> or <code>filter</code> then at least one of the <code>should</code> queries must match a document for it to match the <code>bool</code> query. This behavior may be explicitly controlled by setting the <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.8/query-dsl-minimum-should-match.html"><code>minimum_should_match</code></a> parameter.</td>
</tr>
<tr>
<td><code>filter</code></td>
<td>The clause (query) must appear in matching documents. However unlike <code>must</code> the score of the query will be ignored. Filter clauses are executed in <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.8/query-filter-context.html">filter context</a>, meaning that scoring is ignored and clauses are considered for caching.</td>
</tr>
</tbody></table>
<ul>
<li><p>cURL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GET localhost:<span class="number">9200</span>/megacorp/employee/_search</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;bool&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;must&quot;</span>: &#123;<span class="attr">&quot;match&quot;</span>:&#123;<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;rock&quot;</span>&#125;&#125;,</span><br><span class="line">            <span class="attr">&quot;must_not&quot;</span>:&#123;<span class="attr">&quot;match&quot;</span>:&#123;<span class="attr">&quot;age&quot;</span>:<span class="number">32</span>&#125;&#125;,</span><br><span class="line">            <span class="attr">&quot;filter&quot;</span>:[</span><br><span class="line">                &#123;<span class="attr">&quot;range&quot;</span>:&#123;<span class="attr">&quot;views&quot;</span>:&#123;<span class="attr">&quot;lte&quot;</span>:<span class="number">1</span>&#125;&#125;&#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Response</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;took&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;timed_out&quot;</span>:<span class="literal">false</span>,<span class="attr">&quot;_shards&quot;</span>:&#123;<span class="attr">&quot;total&quot;</span>:<span class="number">5</span>,<span class="attr">&quot;successful&quot;</span>:<span class="number">5</span>,<span class="attr">&quot;skipped&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;failed&quot;</span>:<span class="number">0</span>&#125;,<span class="attr">&quot;hits&quot;</span>:&#123;<span class="attr">&quot;total&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;max_score&quot;</span>:<span class="number">0.2876821</span>,<span class="attr">&quot;hits&quot;</span>:[&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="attr">&quot;_score&quot;</span>:<span class="number">0.2876821</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;John&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Smith&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">25</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I love to go rock climbing&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;sports&quot;</span>,<span class="string">&quot;music&quot;</span>],<span class="attr">&quot;views&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;tags&quot;</span>:[<span class="string">&quot;testing&quot;</span>,<span class="string">&quot;search&quot;</span>]&#125;&#125;]&#125;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="30-2、constant-score查询"><a href="#30-2、constant-score查询" class="headerlink" title="30.2、constant_score查询"></a>30.2、<code>constant_score</code>查询</h3><blockquote>
<p>将一个不变的常量评分应用于所有匹配的文档。它被经常用于你只需要执行一个 filter 而没有其它查询（例如，评分查询）的情况下;可以使用它来取代只有 filter 语句的 <code>bool</code> 查询。在性能上是完全相同的，但对于提高查询简洁性和清晰度有很大帮助;</p>
</blockquote>
<ul>
<li><p>cURL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET localhost:<span class="number">9200</span>/megacorp/employee/_search</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;bool&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;filter&quot;</span>:[</span><br><span class="line">                &#123;<span class="attr">&quot;terms&quot;</span>:&#123;<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;music&quot;</span>]&#125;&#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Response</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;took&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;timed_out&quot;</span>:<span class="literal">false</span>,<span class="attr">&quot;_shards&quot;</span>:&#123;<span class="attr">&quot;total&quot;</span>:<span class="number">5</span>,<span class="attr">&quot;successful&quot;</span>:<span class="number">5</span>,<span class="attr">&quot;skipped&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;failed&quot;</span>:<span class="number">0</span>&#125;,<span class="attr">&quot;hits&quot;</span>:&#123;<span class="attr">&quot;total&quot;</span>:<span class="number">2</span>,<span class="attr">&quot;max_score&quot;</span>:<span class="number">0.0</span>,<span class="attr">&quot;hits&quot;</span>:[&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;2&quot;</span>,<span class="attr">&quot;_score&quot;</span>:<span class="number">0.0</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;Jane&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Smith&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">32</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I like to collect rock albums&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;music&quot;</span>]&#125;&#125;,&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="attr">&quot;_score&quot;</span>:<span class="number">0.0</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;John&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Smith&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">25</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I love to go rock climbing&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;sports&quot;</span>,<span class="string">&quot;music&quot;</span>],<span class="attr">&quot;views&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;tags&quot;</span>:[<span class="string">&quot;testing&quot;</span>,<span class="string">&quot;search&quot;</span>]&#125;&#125;]&#125;&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>由于filter不对评分有贡献，通过bool查询，_score均为0；</p>
</blockquote>
</li>
<li><p>cURL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GET localhost:<span class="number">9200</span>/megacorp/employee/_search</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;constant_score&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;filter&quot;</span>:&#123;</span><br><span class="line">                <span class="attr">&quot;terms&quot;</span>:&#123;</span><br><span class="line">                    <span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;music&quot;</span>]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Response</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;took&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;timed_out&quot;</span>:<span class="literal">false</span>,<span class="attr">&quot;_shards&quot;</span>:&#123;<span class="attr">&quot;total&quot;</span>:<span class="number">5</span>,<span class="attr">&quot;successful&quot;</span>:<span class="number">5</span>,<span class="attr">&quot;skipped&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;failed&quot;</span>:<span class="number">0</span>&#125;,<span class="attr">&quot;hits&quot;</span>:&#123;<span class="attr">&quot;total&quot;</span>:<span class="number">2</span>,<span class="attr">&quot;max_score&quot;</span>:<span class="number">1.0</span>,<span class="attr">&quot;hits&quot;</span>:[&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;2&quot;</span>,<span class="attr">&quot;_score&quot;</span>:<span class="number">1.0</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;Jane&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Smith&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">32</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I like to collect rock albums&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;music&quot;</span>]&#125;&#125;,&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="attr">&quot;_score&quot;</span>:<span class="number">1.0</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;John&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Smith&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">25</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I love to go rock climbing&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;sports&quot;</span>,<span class="string">&quot;music&quot;</span>],<span class="attr">&quot;views&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;tags&quot;</span>:[<span class="string">&quot;testing&quot;</span>,<span class="string">&quot;search&quot;</span>]&#125;&#125;]&#125;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="31、排序"><a href="#31、排序" class="headerlink" title="31、排序"></a>31、排序</h2><h3 id="31-1、按照字段的值进行排序"><a href="#31-1、按照字段的值进行排序" class="headerlink" title="31.1、按照字段的值进行排序"></a>31.1、按照字段的值进行排序</h3><ul>
<li><p>cURL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET localhost:<span class="number">9200</span>/megacorp/employee/_search</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;bool&quot;</span>:&#123;</span><br><span class="line">            <span class="attr">&quot;must&quot;</span>:&#123;</span><br><span class="line">                <span class="attr">&quot;match_all&quot;</span>:&#123;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;sort&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;age&quot;</span>:&#123;<span class="attr">&quot;order&quot;</span>:<span class="string">&quot;desc&quot;</span>&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Response</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;took&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;timed_out&quot;</span>:<span class="literal">false</span>,<span class="attr">&quot;_shards&quot;</span>:&#123;<span class="attr">&quot;total&quot;</span>:<span class="number">5</span>,<span class="attr">&quot;successful&quot;</span>:<span class="number">5</span>,<span class="attr">&quot;skipped&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;failed&quot;</span>:<span class="number">0</span>&#125;,<span class="attr">&quot;hits&quot;</span>:&#123;<span class="attr">&quot;total&quot;</span>:<span class="number">3</span>,<span class="attr">&quot;max_score&quot;</span>:<span class="literal">null</span>,<span class="attr">&quot;hits&quot;</span>:[&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;3&quot;</span>,<span class="attr">&quot;_score&quot;</span>:<span class="literal">null</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;Douglas&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Fir&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">35</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I like to build cabinets&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;forestry&quot;</span>]&#125;,<span class="attr">&quot;sort&quot;</span>:[<span class="number">35</span>]&#125;,&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;2&quot;</span>,<span class="attr">&quot;_score&quot;</span>:<span class="literal">null</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;Jane&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Smith&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">32</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I like to collect rock albums&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;music&quot;</span>]&#125;,<span class="attr">&quot;sort&quot;</span>:[<span class="number">32</span>]&#125;,&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="attr">&quot;_score&quot;</span>:<span class="literal">null</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;John&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Smith&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">25</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I love to go rock climbing&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;sports&quot;</span>,<span class="string">&quot;music&quot;</span>],<span class="attr">&quot;views&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;tags&quot;</span>:[<span class="string">&quot;testing&quot;</span>,<span class="string">&quot;search&quot;</span>]&#125;,<span class="attr">&quot;sort&quot;</span>:[<span class="number">25</span>]&#125;]&#125;&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>默认排序是通过<code>_score</code>,如果指定排序，则<code>_score</code>将不被计算；</p>
<p>如果无论如何都需要计算出<code>_score</code>,可以对<code>track_scores</code>参数设置为true</p>
</blockquote>
</li>
</ul>
<h3 id="31-2、多级排序"><a href="#31-2、多级排序" class="headerlink" title="31.2、多级排序"></a>31.2、多级排序</h3><ul>
<li><p>cURL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">GET localhost:<span class="number">9200</span>/megacorp/employee/_search</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;bool&quot;</span>:&#123;</span><br><span class="line">            <span class="attr">&quot;must&quot;</span>:&#123;</span><br><span class="line">                <span class="attr">&quot;match_all&quot;</span>:&#123;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;sort&quot;</span>:[</span><br><span class="line">        &#123;<span class="attr">&quot;age&quot;</span>:&#123;<span class="attr">&quot;order&quot;</span>:<span class="string">&quot;desc&quot;</span>&#125;&#125;,</span><br><span class="line">        &#123;<span class="attr">&quot;views&quot;</span>:&#123;<span class="attr">&quot;order&quot;</span>:<span class="string">&quot;asc&quot;</span>&#125;&#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Response</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;took&quot;</span>:<span class="number">2</span>,<span class="attr">&quot;timed_out&quot;</span>:<span class="literal">false</span>,<span class="attr">&quot;_shards&quot;</span>:&#123;<span class="attr">&quot;total&quot;</span>:<span class="number">5</span>,<span class="attr">&quot;successful&quot;</span>:<span class="number">5</span>,<span class="attr">&quot;skipped&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;failed&quot;</span>:<span class="number">0</span>&#125;,<span class="attr">&quot;hits&quot;</span>:&#123;<span class="attr">&quot;total&quot;</span>:<span class="number">3</span>,<span class="attr">&quot;max_score&quot;</span>:<span class="literal">null</span>,<span class="attr">&quot;hits&quot;</span>:[&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;3&quot;</span>,<span class="attr">&quot;_score&quot;</span>:<span class="literal">null</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;Douglas&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Fir&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">35</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I like to build cabinets&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;forestry&quot;</span>]&#125;,<span class="attr">&quot;sort&quot;</span>:[<span class="number">35</span>,<span class="number">9223372036854775807</span>]&#125;,&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;2&quot;</span>,<span class="attr">&quot;_score&quot;</span>:<span class="literal">null</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;Jane&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Smith&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">32</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I like to collect rock albums&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;music&quot;</span>]&#125;,<span class="attr">&quot;sort&quot;</span>:[<span class="number">32</span>,<span class="number">9223372036854775807</span>]&#125;,&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="attr">&quot;_score&quot;</span>:<span class="literal">null</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;John&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Smith&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">25</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I love to go rock climbing&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;sports&quot;</span>,<span class="string">&quot;music&quot;</span>],<span class="attr">&quot;views&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;tags&quot;</span>:[<span class="string">&quot;testing&quot;</span>,<span class="string">&quot;search&quot;</span>]&#125;,<span class="attr">&quot;sort&quot;</span>:[<span class="number">25</span>,<span class="number">1</span>]&#125;]&#125;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="32、查找多个精确值"><a href="#32、查找多个精确值" class="headerlink" title="32、查找多个精确值"></a>32、查找多个精确值</h2><ul>
<li><p>cURL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET localhost:<span class="number">9200</span>/megacorp/employee/_search</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;query&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;terms&quot;</span>:&#123;</span><br><span class="line">            <span class="attr">&quot;age&quot;</span>:[<span class="number">25</span>,<span class="number">32</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Response</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;took&quot;</span>:<span class="number">6</span>,<span class="attr">&quot;timed_out&quot;</span>:<span class="literal">false</span>,<span class="attr">&quot;_shards&quot;</span>:&#123;<span class="attr">&quot;total&quot;</span>:<span class="number">5</span>,<span class="attr">&quot;successful&quot;</span>:<span class="number">5</span>,<span class="attr">&quot;skipped&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;failed&quot;</span>:<span class="number">0</span>&#125;,<span class="attr">&quot;hits&quot;</span>:&#123;<span class="attr">&quot;total&quot;</span>:<span class="number">2</span>,<span class="attr">&quot;max_score&quot;</span>:<span class="number">1.0</span>,<span class="attr">&quot;hits&quot;</span>:[&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;2&quot;</span>,<span class="attr">&quot;_score&quot;</span>:<span class="number">1.0</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;Jane&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Smith&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">32</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I like to collect rock albums&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;music&quot;</span>]&#125;&#125;,&#123;<span class="attr">&quot;_index&quot;</span>:<span class="string">&quot;megacorp&quot;</span>,<span class="attr">&quot;_type&quot;</span>:<span class="string">&quot;employee&quot;</span>,<span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="attr">&quot;_score&quot;</span>:<span class="number">1.0</span>,<span class="attr">&quot;_source&quot;</span>:&#123;<span class="attr">&quot;first_name&quot;</span>:<span class="string">&quot;John&quot;</span>,<span class="attr">&quot;last_name&quot;</span>:<span class="string">&quot;Smith&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">25</span>,<span class="attr">&quot;about&quot;</span>:<span class="string">&quot;I love to go rock climbing&quot;</span>,<span class="attr">&quot;interests&quot;</span>:[<span class="string">&quot;sports&quot;</span>,<span class="string">&quot;music&quot;</span>],<span class="attr">&quot;views&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;tags&quot;</span>:[<span class="string">&quot;testing&quot;</span>,<span class="string">&quot;search&quot;</span>]&#125;&#125;]&#125;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/_aggregation_test_drive.html">https://www.elastic.co/guide/cn/elasticsearch/guide/current/_aggregation_test_drive.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.cubetech.group/2021/02/18/Elasticsearch(2.x)%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97/" data-id="ckp7r5g540003i0jdaczr5sng" class="article-share-link">
        Share
      </a>
      
<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Elasticsearch/" rel="tag">Elasticsearch</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag">读书笔记</a></li></ul>

    </footer>

  </div>

  
  
<nav class="article-nav">
  
  <a href="/2021/02/20/%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3Elasticsearch%E7%B4%A2%E5%BC%95%E6%95%B0%E6%8D%AE%E5%BB%B6%E8%BF%9F/" class="article-nav-link">
    <strong class="article-nav-caption">Newer</strong>
    <div class="article-nav-title">
      
      如何解决Elasticsearch索引数据延迟
      
    </div>
  </a>
  
  
  <a href="/2021/02/18/mvn%20deploy%E5%B0%86%E5%BC%80%E5%8F%91%E5%90%8E%E7%9A%84%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83%E5%88%B0%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93/" class="article-nav-link">
    <strong class="article-nav-caption">Older</strong>
    <div class="article-nav-title">mvn deploy将开发后的代码发布到远程仓库</div>
  </a>
  
</nav>

  

  
  
  

  

</article>
</section>
    <footer class="footer">
  <div class="outer">
    <div class="float-right">
      <ul class="list-inline">
  
  <li><i class="fe fe-smile-alt"></i> <span id="busuanzi_value_site_uv"></span></li>
  
  <li><i class="fe fe-bookmark"></i> <span id="busuanzi_value_page_pv"></span></li>
  
</ul>
    </div>
    <ul class="list-inline">
      <li>CUBE &copy; 2021</li>
      
        <li></li>
      
    </ul>
  </div>
</footer>
  </main>
  <aside class="sidebar">
    <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/cubetech.png" alt="CUBE"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">首页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/gallery">相册</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">关于</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="Search">
        <i class="fe fe-search"></i>
        Search
      </a>
    </li>
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      <div class="totop" id="totop">
  <i class="fe fe-rocket"></i>
</div>
    </li>
    <li class="nav-item">
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
  </aside>
  
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>



<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/copybtn.js"></script>





<script src="/js/tocbot.min.js"></script>

<script>
  // Tocbot_v4.7.0  http://tscanlin.github.io/tocbot/
  tocbot.init({
    tocSelector: '.tocbot',
    contentSelector: '.article-entry',
    headingSelector: 'h1, h2, h3, h4, h5, h6',
    hasInnerContainers: true,
    scrollSmooth: true,
    positionFixedSelector: '.tocbot',
    positionFixedClass: 'is-position-fixed',
    fixedSidebarOffset: 'auto',
  });
</script>



<script src="/js/ocean.js"></script>

</body>

</html>